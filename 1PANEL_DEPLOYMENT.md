# 1Panel ÈÉ®ÁΩ≤ÊåáÂçó

Êú¨ÊåáÂçóÂ∞ÜÂ∏ÆÂä©‰Ω†Âú® 1Panel Èù¢Êùø‰∏äÈÉ®ÁΩ≤ÂáØÊ†ºÂ∞îËøêÂä®ËÆ≠ÁªÉÂô®„ÄÇ

## üìã ÂâçÁΩÆË¶ÅÊ±Ç

- Â∑≤ÂÆâË£Ö 1Panel Èù¢Êùø
- ÊúçÂä°Âô®Â∑≤ÂÆâË£Ö Docker Âíå Docker Compose
- Êúâ MySQL Êï∞ÊçÆÂ∫ìÔºàÂèØ‰ª•ÊòØ 1Panel Ëá™Â∏¶ÁöÑÔºå‰πüÂèØ‰ª•ÊòØÂ§ñÈÉ®ÁöÑÔºâ
- ÂüüÂêçÔºàÂèØÈÄâÔºåÁî®‰∫é HTTPSÔºâ

## üöÄ ÈÉ®ÁΩ≤ÊñπÂºè

### ÊñπÂºè 1Ôºö‰ΩøÁî® 1Panel ÁöÑ Docker ComposeÔºàÊé®ËçêÔºâ

#### Á¨¨‰∏ÄÊ≠•ÔºöÂáÜÂ§áÈ°πÁõÆÊñá‰ª∂

1. ÁôªÂΩïÊúçÂä°Âô®ÔºåÂàõÂª∫È°πÁõÆÁõÆÂΩïÔºö
```bash
mkdir -p /opt/kegel
cd /opt/kegel
```

2. ÂÖãÈöÜÈ°πÁõÆÔºàÊàñ‰∏ä‰º†Êñá‰ª∂ÔºâÔºö
```bash
git clone https://github.com/zhanghaonan11/kegel-trainer.git .
```

ÊàñËÄÖ‰ΩøÁî® 1Panel ÁöÑÊñá‰ª∂ÁÆ°ÁêÜÂäüËÉΩ‰∏ä‰º†È°πÁõÆÊñá‰ª∂„ÄÇ

#### Á¨¨‰∫åÊ≠•ÔºöÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè

1. ÂàõÂª∫ `.env` Êñá‰ª∂Ôºö
```bash
cat > .env << 'EOF'
DB_HOST=mysql.sqlpub.com
DB_PORT=3306
DB_USER=‰Ω†ÁöÑÊï∞ÊçÆÂ∫ìÁî®Êà∑Âêç
DB_PASSWORD=‰Ω†ÁöÑÊï∞ÊçÆÂ∫ìÂØÜÁ†Å
DB_NAME=cloudlib
EOF
```

ÊàñËÄÖÂú® 1Panel ‰∏≠Ôºö
- ËøõÂÖ• "ÂÆπÂô®" ‚Üí "ÁºñÊéí"
- ÂàõÂª∫Êñ∞ÁºñÊéí
- Âú®ÁéØÂ¢ÉÂèòÈáè‰∏≠Ê∑ªÂä†‰∏äËø∞ÈÖçÁΩÆ

#### Á¨¨‰∏âÊ≠•ÔºöÂú® 1Panel ‰∏≠ÂàõÂª∫ Docker Compose

1. ÁôªÂΩï 1Panel Èù¢Êùø
2. ËøõÂÖ• "ÂÆπÂô®" ‚Üí "ÁºñÊéí"
3. ÁÇπÂáª "ÂàõÂª∫ÁºñÊéí"
4. Â°´ÂÜô‰ø°ÊÅØÔºö
   - **ÂêçÁß∞**: kegel-trainer
   - **Ë∑ØÂæÑ**: /opt/kegel
   - **ÊèèËø∞**: ÂáØÊ†ºÂ∞îËøêÂä®ËÆ≠ÁªÉÂô®

5. Â§çÂà∂ `docker-compose.yml` ÂÜÖÂÆπÂà∞ÁºñËæëÂô®

6. ÁÇπÂáª "Á°ÆËÆ§"

#### Á¨¨ÂõõÊ≠•ÔºöÂêØÂä®ÊúçÂä°

1. Âú®ÁºñÊéíÂàóË°®‰∏≠ÊâæÂà∞ `kegel-trainer`
2. ÁÇπÂáª "ÂêØÂä®"
3. Á≠âÂæÖÂÆπÂô®ÂêØÂä®ÔºàÁ∫¶ 30 ÁßíÔºâ

#### Á¨¨‰∫îÊ≠•ÔºöÈ™åËØÅÈÉ®ÁΩ≤

1. Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅÔºö
   - ËøõÂÖ• "ÂÆπÂô®" ‚Üí "ÂÆπÂô®"
   - Êü•Áúã `kegel-api` Âíå `kegel-nginx` ÊòØÂê¶ËøêË°åÊ≠£Â∏∏

2. ËÆøÈóÆÂ∫îÁî®Ôºö
   - ÊµèËßàÂô®ËÆøÈóÆÔºö`http://‰Ω†ÁöÑÊúçÂä°Âô®IP`
   - ÊµãËØï APIÔºö`http://‰Ω†ÁöÑÊúçÂä°Âô®IP/api/health`

### ÊñπÂºè 2Ôºö‰ΩøÁî® 1Panel ÁöÑÁΩëÁ´ôÂäüËÉΩ

#### Á¨¨‰∏ÄÊ≠•ÔºöÂàõÂª∫ÁΩëÁ´ô

1. ËøõÂÖ• "ÁΩëÁ´ô" ‚Üí "ÁΩëÁ´ô"
2. ÁÇπÂáª "ÂàõÂª∫ÁΩëÁ´ô"
3. Â°´ÂÜô‰ø°ÊÅØÔºö
   - **ÂüüÂêç**: ‰Ω†ÁöÑÂüüÂêçÔºàÊàñ‰ΩøÁî® IPÔºâ
   - **Á±ªÂûã**: ÈùôÊÄÅÁΩëÁ´ô
   - **Ê†πÁõÆÂΩï**: /opt/kegel

#### Á¨¨‰∫åÊ≠•ÔºöÈÖçÁΩÆÂèçÂêë‰ª£ÁêÜ

1. ÂÖàÂêØÂä® API ÂÆπÂô®Ôºö
```bash
cd /opt/kegel
docker-compose up -d api
```

2. Âú®ÁΩëÁ´ôËÆæÁΩÆ‰∏≠Ôºö
   - ËøõÂÖ• "ÂèçÂêë‰ª£ÁêÜ"
   - Ê∑ªÂä†‰ª£ÁêÜËßÑÂàôÔºö
     - **Ë∑ØÂæÑ**: /api
     - **ÁõÆÊ†áÂú∞ÂùÄ**: http://localhost:3000

#### Á¨¨‰∏âÊ≠•ÔºöÈÖçÁΩÆ SSLÔºàÂèØÈÄâÔºâ

1. Âú®ÁΩëÁ´ôËÆæÁΩÆ‰∏≠ËøõÂÖ• "SSL"
2. ÈÄâÊã© "Let's Encrypt"
3. Áî≥ËØ∑ËØÅ‰π¶

### ÊñπÂºè 3Ôºö‰ΩøÁî® 1Panel ÁöÑÂ∫îÁî®ÂïÜÂ∫óÔºàÂ¶ÇÊûúÊúâÔºâ

Â¶ÇÊûú 1Panel Â∫îÁî®ÂïÜÂ∫ó‰∏≠ÊúâÊ≠§Â∫îÁî®ÔºåÂèØ‰ª•Áõ¥Êé•ÂÆâË£Ö„ÄÇ

## üîß ÈÖçÁΩÆÊï∞ÊçÆÂ∫ì

### ‰ΩøÁî® 1Panel Ëá™Â∏¶ÁöÑ MySQL

1. ËøõÂÖ• "Êï∞ÊçÆÂ∫ì" ‚Üí "MySQL"
2. ÂàõÂª∫Êï∞ÊçÆÂ∫ìÔºö
   - **Êï∞ÊçÆÂ∫ìÂêç**: kegel
   - **Â≠óÁ¨¶ÈõÜ**: utf8mb4
   - **ÊéíÂ∫èËßÑÂàô**: utf8mb4_unicode_ci

3. ÂàõÂª∫Áî®Êà∑Ôºö
   - **Áî®Êà∑Âêç**: kegel_user
   - **ÂØÜÁ†Å**: ËÆæÁΩÆÂº∫ÂØÜÁ†Å
   - **ÊùÉÈôê**: Êéà‰∫à kegel Êï∞ÊçÆÂ∫ìÁöÑÊâÄÊúâÊùÉÈôê

4. Êõ¥Êñ∞ `.env` Êñá‰ª∂Ôºö
```bash
DB_HOST=localhost  # Êàñ 1Panel MySQL ÂÆπÂô®Âêç
DB_PORT=3306
DB_USER=kegel_user
DB_PASSWORD=‰Ω†ËÆæÁΩÆÁöÑÂØÜÁ†Å
DB_NAME=kegel
```

### ‰ΩøÁî®Â§ñÈÉ® MySQL

Áõ¥Êé•Âú® `.env` ‰∏≠ÈÖçÁΩÆÂ§ñÈÉ®Êï∞ÊçÆÂ∫ì‰ø°ÊÅØÂç≥ÂèØ„ÄÇ

## üìä ÁõëÊéßÂíåÁÆ°ÁêÜ

### Êü•ÁúãÊó•Âøó

#### ÊñπÂºè 1ÔºöÈÄöËøá 1Panel

1. ËøõÂÖ• "ÂÆπÂô®" ‚Üí "ÂÆπÂô®"
2. ÊâæÂà∞ `kegel-api` Êàñ `kegel-nginx`
3. ÁÇπÂáª "Êó•Âøó" Êü•Áúã

#### ÊñπÂºè 2ÔºöÂëΩ‰ª§Ë°å

```bash
# API Êó•Âøó
docker logs -f kegel-api

# Nginx Êó•Âøó
docker logs -f kegel-nginx

# ÊâÄÊúâÊó•Âøó
docker-compose logs -f
```

### ÈáçÂêØÊúçÂä°

#### ÈÄöËøá 1Panel

1. ËøõÂÖ• "ÂÆπÂô®" ‚Üí "ÁºñÊéí"
2. ÊâæÂà∞ `kegel-trainer`
3. ÁÇπÂáª "ÈáçÂêØ"

#### ÂëΩ‰ª§Ë°å

```bash
cd /opt/kegel
docker-compose restart
```

### Êõ¥Êñ∞Â∫îÁî®

```bash
cd /opt/kegel
git pull
docker-compose down
docker-compose up -d --build
```

## üîí ÂÆâÂÖ®ÈÖçÁΩÆ

### 1. ÈÖçÁΩÆÈò≤ÁÅ´Â¢ô

Âú® 1Panel ‰∏≠Ôºö
1. ËøõÂÖ• "‰∏ªÊú∫" ‚Üí "Èò≤ÁÅ´Â¢ô"
2. ÂºÄÊîæÁ´ØÂè£Ôºö
   - 80 (HTTP)
   - 443 (HTTPSÔºåÂ¶ÇÊûú‰ΩøÁî® SSL)

### 2. ÈÖçÁΩÆ SSL ËØÅ‰π¶

#### ‰ΩøÁî® 1Panel Ëá™Âä®Áî≥ËØ∑

1. ËøõÂÖ• "ÁΩëÁ´ô" ‚Üí ÈÄâÊã©‰Ω†ÁöÑÁΩëÁ´ô
2. ÁÇπÂáª "SSL"
3. ÈÄâÊã© "Let's Encrypt"
4. Â°´ÂÜôÈÇÆÁÆ±Âπ∂Áî≥ËØ∑

#### ÊâãÂä®ÈÖçÁΩÆ

‰øÆÊîπ `nginx.conf` Ê∑ªÂä† SSL ÈÖçÁΩÆÔºö

```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # ... ÂÖ∂‰ªñÈÖçÁΩÆ
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

### 3. ÈôêÂà∂ËÆøÈóÆ

Âú® `nginx.conf` ‰∏≠Ê∑ªÂä†Ôºö

```nginx
# ÈôêÂà∂ËØ∑Ê±ÇÈ¢ëÁéá
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

location /api/ {
    limit_req zone=api_limit burst=20 nodelay;
    # ... ÂÖ∂‰ªñÈÖçÁΩÆ
}
```

## üìà ÊÄßËÉΩ‰ºòÂåñ

### 1. Ë∞ÉÊï¥ Docker ËµÑÊ∫êÈôêÂà∂

‰øÆÊîπ `docker-compose.yml`Ôºö

```yaml
services:
  api:
    # ... ÂÖ∂‰ªñÈÖçÁΩÆ
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
```

### 2. ÂêØÁî® Nginx ÁºìÂ≠ò

Âú® `nginx.conf` ‰∏≠Ê∑ªÂä†Ôºö

```nginx
# ÁºìÂ≠òÈÖçÁΩÆ
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=100m inactive=60m;

location /api/ {
    proxy_cache api_cache;
    proxy_cache_valid 200 5m;
    proxy_cache_key "$scheme$request_method$host$request_uri";
    # ... ÂÖ∂‰ªñÈÖçÁΩÆ
}
```

### 3. Êï∞ÊçÆÂ∫ìËøûÊé•Ê±†‰ºòÂåñ

‰øÆÊîπ `api/db.js`Ôºö

```javascript
const pool = mysql.createPool({
  // ... ÂÖ∂‰ªñÈÖçÁΩÆ
  connectionLimit: 20,  // Â¢ûÂä†ËøûÊé•Êï∞
  queueLimit: 0,
  waitForConnections: true
});
```

## üîÑ Â§á‰ªΩÂíåÊÅ¢Â§ç

### Â§á‰ªΩÊï∞ÊçÆÂ∫ì

#### ‰ΩøÁî® 1Panel

1. ËøõÂÖ• "Êï∞ÊçÆÂ∫ì" ‚Üí "MySQL"
2. ÈÄâÊã©Êï∞ÊçÆÂ∫ì
3. ÁÇπÂáª "Â§á‰ªΩ"

#### ÂëΩ‰ª§Ë°å

```bash
# Â§á‰ªΩ
docker exec kegel-api sh -c 'mysqldump -h $DB_HOST -u $DB_USER -p$DB_PASSWORD $DB_NAME' > backup.sql

# ÊÅ¢Â§ç
docker exec -i kegel-api sh -c 'mysql -h $DB_HOST -u $DB_USER -p$DB_PASSWORD $DB_NAME' < backup.sql
```

### Â§á‰ªΩÂ∫îÁî®Êï∞ÊçÆ

```bash
# Â§á‰ªΩÊï¥‰∏™È°πÁõÆ
tar -czf kegel-backup-$(date +%Y%m%d).tar.gz /opt/kegel

# ÊÅ¢Â§ç
tar -xzf kegel-backup-20251208.tar.gz -C /
```

## üêõ ÊïÖÈöúÊéíÊü•

### ÈóÆÈ¢ò 1ÔºöÂÆπÂô®Êó†Ê≥ïÂêØÂä®

**Ê£ÄÊü•Êó•Âøó**Ôºö
```bash
docker-compose logs api
```

**Â∏∏ËßÅÂéüÂõ†**Ôºö
- Á´ØÂè£Ë¢´Âç†Áî®Ôºö‰øÆÊîπ `docker-compose.yml` ‰∏≠ÁöÑÁ´ØÂè£
- ÁéØÂ¢ÉÂèòÈáèÈîôËØØÔºöÊ£ÄÊü• `.env` Êñá‰ª∂
- Êï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•ÔºöÊ£ÄÊü•Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ

### ÈóÆÈ¢ò 2ÔºöÊó†Ê≥ïËÆøÈóÆÁΩëÁ´ô

**Ê£ÄÊü•**Ôºö
1. ÂÆπÂô®ÊòØÂê¶ËøêË°åÔºö`docker ps`
2. Á´ØÂè£ÊòØÂê¶ÂºÄÊîæÔºöÂú® 1Panel Èò≤ÁÅ´Â¢ô‰∏≠Ê£ÄÊü•
3. Nginx ÈÖçÁΩÆÊòØÂê¶Ê≠£Á°ÆÔºö`docker exec kegel-nginx nginx -t`

### ÈóÆÈ¢ò 3ÔºöAPI ËøîÂõû 500 ÈîôËØØ

**Ê£ÄÊü•**Ôºö
1. Êï∞ÊçÆÂ∫ìËøûÊé•Ôºö`docker exec kegel-api node -e "require('./db').testConnection()"`
2. ÁéØÂ¢ÉÂèòÈáèÔºö`docker exec kegel-api env | grep DB_`
3. API Êó•ÂøóÔºö`docker logs kegel-api`

### ÈóÆÈ¢ò 4ÔºöÊï∞ÊçÆÂ∫ìËøûÊé•Â§±Ë¥•

**Ëß£ÂÜ≥ÊñπÊ°à**Ôºö
1. Ê£ÄÊü•Êï∞ÊçÆÂ∫ìÊòØÂê¶ËøêË°å
2. Ê£ÄÊü•Êï∞ÊçÆÂ∫ìÁî®Êà∑ÊùÉÈôê
3. Ê£ÄÊü•Èò≤ÁÅ´Â¢ôËßÑÂàô
4. Â¶ÇÊûú‰ΩøÁî® 1Panel MySQLÔºåÁ°Æ‰øùÂÆπÂô®Âú®Âêå‰∏ÄÁΩëÁªú

## üìû Ëé∑ÂèñÂ∏ÆÂä©

### Êü•ÁúãÊñáÊ°£
- È°πÁõÆ README: `README.md`
- API ÊñáÊ°£: `api/README.md`
- Êï∞ÊçÆÂ∫ìÈÖçÁΩÆ: `DATABASE_SETUP.md`

### Â∏∏Áî®ÂëΩ‰ª§

```bash
# Êü•ÁúãÂÆπÂô®Áä∂ÊÄÅ
docker-compose ps

# Êü•ÁúãÊó•Âøó
docker-compose logs -f

# ÈáçÂêØÊúçÂä°
docker-compose restart

# ÂÅúÊ≠¢ÊúçÂä°
docker-compose down

# ÂêØÂä®ÊúçÂä°
docker-compose up -d

# ÈáçÊñ∞ÊûÑÂª∫Âπ∂ÂêØÂä®
docker-compose up -d --build

# ËøõÂÖ•ÂÆπÂô®
docker exec -it kegel-api sh

# Êü•ÁúãËµÑÊ∫ê‰ΩøÁî®
docker stats kegel-api kegel-nginx
```

## üéØ ÊúÄ‰Ω≥ÂÆûË∑µ

1. **ÂÆöÊúüÂ§á‰ªΩ**ÔºöËÆæÁΩÆÂÆöÊó∂‰ªªÂä°Â§á‰ªΩÊï∞ÊçÆÂ∫ì
2. **ÁõëÊéßÊó•Âøó**ÔºöÂÆöÊúüÊü•ÁúãÊó•ÂøóÔºåÂèäÊó∂ÂèëÁé∞ÈóÆÈ¢ò
3. **Êõ¥Êñ∞Â∫îÁî®**ÔºöÂÆöÊúüÊõ¥Êñ∞Âà∞ÊúÄÊñ∞ÁâàÊú¨
4. **ÂÆâÂÖ®Âä†Âõ∫**Ôºö‰ΩøÁî® HTTPSÔºåÈôêÂà∂ËÆøÈóÆÈ¢ëÁéá
5. **ÊÄßËÉΩÁõëÊéß**Ôºö‰ΩøÁî® 1Panel ÁöÑÁõëÊéßÂäüËÉΩ

## üìã ÈÉ®ÁΩ≤Ê∏ÖÂçï

- [ ] ÊúçÂä°Âô®Â∑≤ÂÆâË£Ö 1Panel
- [ ] Docker Âíå Docker Compose Â∑≤ÂÆâË£Ö
- [ ] È°πÁõÆÊñá‰ª∂Â∑≤‰∏ä‰º†Âà∞ `/opt/kegel`
- [ ] `.env` Êñá‰ª∂Â∑≤ÈÖçÁΩÆ
- [ ] Êï∞ÊçÆÂ∫ìÂ∑≤ÂàõÂª∫
- [ ] Docker Compose Â∑≤ÂàõÂª∫Âπ∂ÂêØÂä®
- [ ] Èò≤ÁÅ´Â¢ôÁ´ØÂè£Â∑≤ÂºÄÊîæ
- [ ] ÁΩëÁ´ôÂèØ‰ª•Ê≠£Â∏∏ËÆøÈóÆ
- [ ] API ÂÅ•Â∫∑Ê£ÄÊü•ÈÄöËøá
- [ ] SSL ËØÅ‰π¶Â∑≤ÈÖçÁΩÆÔºàÂèØÈÄâÔºâ
- [ ] Â§á‰ªΩÁ≠ñÁï•Â∑≤ËÆæÁΩÆ

## üåê ËÆøÈóÆÂú∞ÂùÄ

ÈÉ®ÁΩ≤ÂÆåÊàêÂêéÔºö
- **ÂâçÁ´Ø**: http://‰Ω†ÁöÑÂüüÂêç Êàñ http://‰Ω†ÁöÑIP
- **API**: http://‰Ω†ÁöÑÂüüÂêç/api Êàñ http://‰Ω†ÁöÑIP/api
- **ÂÅ•Â∫∑Ê£ÄÊü•**: http://‰Ω†ÁöÑÂüüÂêç/api/health

## üìÑ ËÆ∏ÂèØËØÅ

MIT License
